{"remainingRequest":"/fun/wedding/wedding-invitation-master/node_modules/thread-loader/dist/cjs.js!/fun/wedding/wedding-invitation-master/node_modules/babel-loader/lib/index.js!/fun/wedding/wedding-invitation-master/node_modules/cache-loader/dist/cjs.js??ref--0-0!/fun/wedding/wedding-invitation-master/node_modules/vue-loader/lib/index.js??vue-loader-options!/fun/wedding/wedding-invitation-master/src/components/Barrage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/fun/wedding/wedding-invitation-master/src/components/Barrage.vue","mtime":1629129434000},{"path":"/fun/wedding/wedding-invitation-master/node_modules/cache-loader/dist/cjs.js","mtime":1629694811101},{"path":"/fun/wedding/wedding-invitation-master/node_modules/thread-loader/dist/cjs.js","mtime":1629694811717},{"path":"/fun/wedding/wedding-invitation-master/node_modules/babel-loader/lib/index.js","mtime":1629694803773},{"path":"/fun/wedding/wedding-invitation-master/node_modules/cache-loader/dist/cjs.js","mtime":1629694811101},{"path":"/fun/wedding/wedding-invitation-master/node_modules/vue-loader/lib/index.js","mtime":1629694811776}],"contextDependencies":[],"result":["import _toConsumableArray from \"/fun/wedding/wedding-invitation-master/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.regexp.replace\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/*global tcb*/\nimport mockData from \"../mock/data\";\nimport { envId } from \"../../cloudbaserc.json\";\nexport default {\n  props: ['wish', 'canStart'],\n  data: function data() {\n    return {\n      barrages: mockData.barrages,\n      animationStyle: '',\n      initialOffset: 0,\n      app: null // 云开发实例\n\n    };\n  },\n  computed: {\n    codeInStyleTag: function codeInStyleTag() {\n      return \"<style>\".concat(this.animationStyle, \"</style>\");\n    }\n  },\n  watch: {\n    canStart: function canStart(val) {\n      if (val === true) {\n        this.barrageAnimationStart();\n      }\n    },\n    wish: function wish() {\n      this.setBarrage();\n    }\n  },\n  mounted: function mounted() {\n    this.checkTcbLoaded();\n  },\n  methods: {\n    // 弹幕动画开始\n    barrageAnimationStart: function barrageAnimationStart() {\n      var _this = this;\n\n      var barrageWidth = this.getWidth(this.$refs.barrage);\n      var barrageWidthGroup = [this.getWidth(this.$refs.barrageFirst), this.getWidth(this.$refs.barrageSecond), this.getWidth(this.$refs.barrageThird), this.getWidth(this.$refs.barrageFourth)];\n      this.initialOffset = barrageWidth + 15;\n      barrageWidthGroup.map(function (item, index) {\n        _this.animationStyle += \"\\n          .barrage-\".concat(index, \"{\\n            animation: barrage-\").concat(index, \" \").concat(item / 40, \"s linear infinite;\\n            -webkit-animation: barrage-\").concat(index, \" \").concat(item / 40, \"s linear infinite;\\n          }\\n          @keyframes barrage-\").concat(index, \" {\\n            from {\\n              transform:translate3d(\").concat(barrageWidth + 15, \"px,0,0);\\n              -webkit-transform:translate3d(\").concat(barrageWidth + 15, \"px,0,0);\\n            }\\n            to {\\n              transform:translate3d(-\").concat(item + 15, \"px,0,0);\\n              -webkit-transform:translate3d(-\").concat(item + 15, \"px,0,0);\\n            }\\n          }\");\n      });\n    },\n    getWidth: function getWidth(ref) {\n      return window.getComputedStyle(ref, null).width.replace('px', '') - 0;\n    },\n    filterBarrage: function filterBarrage(barrages, remainder) {\n      if (barrages) {\n        return barrages.filter(function (barrage, index) {\n          if (index % 4 === remainder) {\n            return barrage;\n          }\n        });\n      }\n    },\n    checkTcbLoaded: function checkTcbLoaded() {\n      var _this2 = this;\n\n      // tcb.js 异步加载加快速度，所以循环判断下是否加载成功\n      if (typeof tcb !== 'undefined') {\n        this.app = tcb.init({\n          env: envId\n        });\n        this.app.auth().signInAnonymously().then(function () {\n          _this2.fetchBarrage();\n        });\n        return;\n      }\n\n      setTimeout(this.checkTcbLoaded, 1000);\n    },\n    fetchBarrage: function fetchBarrage() {\n      var _this3 = this;\n\n      this.app.callFunction({\n        name: 'getBarrage'\n      }).then(function () {\n        var _this3$barrages;\n\n        var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n            _ref$result = _ref.result;\n\n        _ref$result = _ref$result === void 0 ? {} : _ref$result;\n        var code = _ref$result.code,\n            _ref$result$result = _ref$result.result,\n            result = _ref$result$result === void 0 ? [] : _ref$result$result;\n\n        if (code) {\n          return;\n        }\n\n        (_this3$barrages = _this3.barrages).unshift.apply(_this3$barrages, _toConsumableArray(result));\n      });\n    },\n    setBarrage: function setBarrage() {\n      if (!this.app || !this.wish) {\n        return;\n      }\n\n      this.app.callFunction({\n        name: 'addBarrage',\n        data: {\n          barrage: this.wish\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["Barrage.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"wedding-barrage\" ref=\"barrage\" :style=\"{opacity: canStart ? 1 : 0}\">\n    <div v-html=\"codeInStyleTag\"></div>\n    <p class=\"code barrage-0\" ref=\"barrageFirst\" :style=\"{transform:'translate('+initialOffset+'px)',top:'10px'}\">\n      <span class=\"mine\">{{ wish }}</span>\n      <span v-for=\"(item, index) in filterBarrage(barrages, 0)\" :key=\"index\">{{ item }}</span>\n    </p>\n    <p class=\"code barrage-1\" ref=\"barrageSecond\" :style=\"{transform:'translate('+initialOffset+'px)',top:'40px'}\">\n      <span v-for=\"(item, index) in filterBarrage(barrages, 1)\" :key=\"index\">{{ item }}</span>\n    </p>\n    <p class=\"code barrage-2\" ref=\"barrageThird\" :style=\"{transform:'translate('+initialOffset+'px)',top:'70px'}\">\n      <span v-for=\"(item, index) in filterBarrage(barrages, 2)\" :key=\"index\">{{ item }}</span>\n    </p>\n    <p class=\"code barrage-3\" ref=\"barrageFourth\" :style=\"{transform:'translate('+initialOffset+'px)',top:'100px'}\">\n      <span v-for=\"(item, index) in filterBarrage(barrages, 3)\" :key=\"index\">{{ item }}</span>\n    </p>\n    <div class=\"barrage-space\"></div>\n  </div>\n</template>\n\n<script>\n  /*global tcb*/\n  import mockData from '../mock/data'\n  import { envId } from '../../cloudbaserc.json'\n\n  export default {\n    props: ['wish', 'canStart'],\n    data() {\n      return {\n        barrages: mockData.barrages,\n        animationStyle:'',\n        initialOffset: 0,\n        app: null, // 云开发实例\n      }\n    },\n    computed: {\n      codeInStyleTag: function () {\n        return `<style>${this.animationStyle}</style>`\n      }\n    },\n    watch: {\n      canStart(val) {\n        if (val===true) {\n          this.barrageAnimationStart()\n        }\n      },\n      wish() {\n        this.setBarrage()\n      }\n    },\n    mounted() {\n      this.checkTcbLoaded()\n    },\n    methods: {\n      // 弹幕动画开始\n      barrageAnimationStart() {\n        let barrageWidth = this.getWidth(this.$refs.barrage)\n        let barrageWidthGroup = [\n              this.getWidth(this.$refs.barrageFirst),\n              this.getWidth(this.$refs.barrageSecond),\n              this.getWidth(this.$refs.barrageThird),\n              this.getWidth(this.$refs.barrageFourth)\n            ]\n        this.initialOffset = barrageWidth + 15\n        barrageWidthGroup.map((item,index) => {\n          this.animationStyle += `\n            .barrage-${index}{\n              animation: barrage-${index} ${item/40}s linear infinite;\n              -webkit-animation: barrage-${index} ${item/40}s linear infinite;\n            }\n            @keyframes barrage-${index} {\n              from {\n                transform:translate3d(${barrageWidth+15}px,0,0);\n                -webkit-transform:translate3d(${barrageWidth+15}px,0,0);\n              }\n              to {\n                transform:translate3d(-${item+15}px,0,0);\n                -webkit-transform:translate3d(-${item+15}px,0,0);\n              }\n            }`\n        })\n      },\n      getWidth(ref) {\n        return window.getComputedStyle(ref,null).width.replace('px','') - 0\n      },\n      filterBarrage(barrages, remainder) {\n        if(barrages){\n          return barrages.filter((barrage, index) => {\n            if(index%4 === remainder){\n              return barrage\n            }\n          })\n        }\n      },\n      checkTcbLoaded() {\n        // tcb.js 异步加载加快速度，所以循环判断下是否加载成功\n        if (typeof tcb !== 'undefined') {\n          this.app = tcb.init({\n            env: envId,\n          });\n\n          this.app.auth().signInAnonymously().then(() => {\n            this.fetchBarrage()\n          })\n          return\n        }\n\n        setTimeout(this.checkTcbLoaded, 1000)\n      },\n      fetchBarrage() {\n        this.app.callFunction({\n          name: 'getBarrage'\n        }).then(({ result: { code, result = [] } = {} } = {}) => {\n          if (code) {\n            return\n          }\n          this.barrages.unshift(...result)\n        })\n      },\n      setBarrage() {\n        if (!this.app || !this.wish) {\n          return\n        }\n\n        this.app.callFunction({\n          name: 'addBarrage',\n          data: {\n            barrage: this.wish,\n          },\n        })\n      },\n    }\n  }\n</script>\n\n<style lang=\"less\">\n  .wedding-barrage{\n    position: relative;\n    p{\n      position: absolute;\n      padding: 5px 0;\n      white-space:nowrap;\n      transition: all 0.6s linear;\n      -webkit-transition: all 0.6s linear;\n      span{\n        padding: 0 15px;\n        &.mine{\n          color: #e6db74;\n          padding: 4px 6px;\n          border: 1px solid #e6db74;\n        }\n      }\n    }\n    .barrage-space{\n      height: 180px;\n    }\n  }\n</style>"],"sourceRoot":"src/components"}]}